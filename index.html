<!DOCTYPE html>
<html lang="en">

<head>
    <title>Udacity Todos Goals</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.1.2/redux.min.js"></script>
    <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.17.6/babel.min.js"></script>
    <script src="https://tylermcginnis.com/goals-todos-api/index.js"></script>
    <script src="https://unpkg.com/redux-thunk@2.2.0/dist/redux-thunk.min.js"></script>
    <script src="https://unpkg.com/react-redux@7.2.6/dist/react-redux.min.js"></script>
</head>

<body>
<div id="app"></div>

<script src="scripts.js"></script>
<script type="text/babel">
    const store = Redux.createStore(
        Redux.combineReducers({
            todos,
            goals,
            loading,
        }),
        Redux.applyMiddleware(ReduxThunk.default, logger, checker)
    );

    const App = (props) => {
        const [value, setValue] = React.useState(0)

        React.useEffect(() => {
            props.dispatch(handleInitialData())
        }, []);

        if (props.loading === true) {
            return <h3>Loading</h3>
        }

        return (
            <div>
                <ConnectedTodos/>
                <ConnectedGoals/>
            </div>
        )
    }

    const ConnectedApp = ReactRedux.connect((state) => ({
        loading: state.loading,
    }))(App);

    const Todos = (props) => {
        const inputRef = React.useRef();

        const addItem = (event) => {
            event.preventDefault();
            props.dispatch(handleAddTodo(inputRef.current.value, () => inputRef.current.value = "  "))
        }

        const removeItem = todo => {
            props.dispatch(handleDeleteTodo(todo));
        }

        const toggleItem = todo => {
            props.dispatch(handleToggleTodo(todo.id));
        }

        return (
            <div>
                <h3>Todo List</h3>
                <input type="text" placeholder="Add Todo" ref={inputRef}/>
                <button onClick={addItem}>Add Todo</button>
                <List remove={removeItem} toggle={toggleItem} items={props.todos}/>
            </div>
        )
    }

    const ConnectedTodos = ReactRedux.connect((state) => ({
        todos: state.todos,
    }))(Todos);

    const Goals = (props) => {
        const inputRef = React.useRef();

        const addItem = (e) => {
            e.preventDefault();
            props.dispatch(
                handleAddGoal(
                    inputRef.current.value,
                    () => (inputRef.current.value = "")
                )
            );
        };

        const removeItem = (goal) => {
            props.dispatch(handleDeleteGoal(goal));
        };

        return (
            <div>
                <h1>Goals</h1>
                <input type="text" placeholder="Add Goal" ref={inputRef}/>
                <button onClick={addItem}>Add Goal</button>

                <List items={props.goals} remove={removeItem}/>
            </div>
        );
    };

    const ConnectedGoals = ReactRedux.connect((state) => ({
        goals: state.goals,
    }))(Goals);

    const List = (props) => {
        return (
            <ul>
                {props.items && props.items.map((item) => {
                    return (
                        <li key={item.id}>
                            <span
                                style={{
                                    textDecoration: item.complete ? "line-through" : "none"
                                }}
                                onClick={() => props.toggle && props.toggle(item)}>{item.name}</span>
                            <button onClick={() => props.remove(item)}>X</button>
                        </li>
                    )
                })}
            </ul>
        )
    };
    
    ReactDOM.render(
        <ReactRedux.Provider store={store}>
            <ConnectedApp/>
        </ReactRedux.Provider>,
        document.getElementById('app')
    )
</script>
</body>

</html>